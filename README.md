# SMC-UserService

–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–π–∫–∏.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **Clean Architecture** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤:
- **Domain** - –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (User, Car)
- **Service** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **Repository** - —Ä–∞–±–æ—Ç–∞ —Å –ë–î (PostgreSQL + sqlx)
- **Handlers** - HTTP API
- **Middleware** - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (MVP), Prometheus –º–µ—Ç—Ä–∏–∫–∏
- **Logging** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (INFO, WARN, ERROR)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ –≤ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
make docker-up
```

–ò–ª–∏:
```bash
docker-compose up -d
```

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- **App**: http://localhost:8080
- **PostgreSQL**: –ø–æ—Ä—Ç **5435**
- **Prometheus**: http://localhost:9091
- **Grafana**: http://localhost:3001 (admin/admin)

–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `make docker-logs-app`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:
```bash
make dev
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
make run
```

–õ–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –∏ `logs/app.log` (WARN –∏ ERROR)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—É–±–ª–∏—á–Ω—ã–π endpoint)
```bash
curl -X POST http://localhost:8080/users \
  -H "Content-Type: application/json" \
  -d '{
    "tg_user_id": 123456789,
    "name": "–ò–≤–∞–Ω",
    "phone_number": "+79991234567",
    "tg_link": "@ivan",
    "role": "client"
  }'
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ X-User-ID –∏ X-User-Role)
```bash
curl -X GET http://localhost:8080/users/me \
  -H "X-User-ID: 123456789" \
  -H "X-User-Role: client"
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID (–º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
```bash
curl -X GET http://localhost:8080/internal/users/123456789
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
```bash
curl -X GET http://localhost:8080/internal/users/123456789/cars/selected
```

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∫–∞–∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ
```bash
curl -X PUT http://localhost:8080/users/me/cars/2/select \
  -H "X-User-ID: 123456789" \
  -H "X-User-Role: client"
```

## üìã API Endpoints

### Public
- `POST /users` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–æ–ª–∏)

### Internal (–º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
- `GET /internal/users/{tg_user_id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ –ø–æ ID
- `GET /internal/users/{tg_user_id}/cars/selected` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ ID

### Protected (—Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ X-User-ID –∏ X-User-Role)

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `GET /users/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ (–≤–∫–ª—é—á–∞–µ—Ç is_selected –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è)
- `PUT /users/me` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `DELETE /users/me` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏
- `POST /users/me/cars` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–ø–µ—Ä–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º)
- `PATCH /users/me/cars/{car_id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (car_id: int64)
- `DELETE /users/me/cars/{car_id}` - —É–¥–∞–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (car_id: int64, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ, –ø–µ—Ä–≤—ã–π –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º)
- `PUT /users/me/cars/{car_id}/select` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∫–∞–∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ

**–õ–æ–≥–∏–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è:**
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü–µ—Ä–≤—ã–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –¥—Ä—É–≥–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å –≤—ã–±–æ—Ä–∞
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –ø–µ—Ä–≤—ã–π –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º
- –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π, –Ω–∏ –æ–¥–∏–Ω –Ω–µ –≤—ã–±—Ä–∞–Ω

### Monitoring
- `GET /metrics` - Prometheus –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenMetrics

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Makefile –∫–æ–º–∞–Ω–¥—ã

```bash
make help              # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
make build             # –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª
make run               # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
make test              # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make clean             # –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–±–æ—Ä–∫–∏ –∏ –ª–æ–≥–∏
make clean-all         # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (artifacts + logs + volumes + images)
make install           # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

**Docker –∫–æ–º–∞–Ω–¥—ã:**
```bash
make docker-build      # –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
make docker-up         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-down       # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-restart    # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make docker-logs       # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make docker-logs-app   # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make docker-clean      # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –∏ —É–¥–∞–ª–∏—Ç—å volumes
make docker-prune      # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ Docker –æ–±—Ä–∞–∑—ã –ø—Ä–æ–µ–∫—Ç–∞
```

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î:**
```bash
make migrate-up        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-down      # –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make db-reset          # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î (down -v + up)
```

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
```bash
make dev               # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SMC-UserService/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ main.go                           # Entry point
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ domain/                           # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (User, Car)
‚îÇ   ‚îú‚îÄ‚îÄ service/user/                     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ + DTOs
‚îÇ   ‚îú‚îÄ‚îÄ infra/storage/                    # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (PostgreSQL)
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îú‚îÄ‚îÄ api/                          # HTTP handlers (handler per endpoint)
‚îÇ       ‚îî‚îÄ‚îÄ middleware/                   # Auth + Metrics middleware
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îú‚îÄ‚îÄ logger/                           # –ö–∞—Å—Ç–æ–º–Ω—ã–π –ª–æ–≥–≥–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ psqlbuilder/                      # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è SQL (squirrel wrapper)
‚îú‚îÄ‚îÄ monitoring/
‚îÇ   ‚îú‚îÄ‚îÄ prometheus/prometheus.yml         # Prometheus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ grafana/                          # Grafana dashboards + datasources
‚îú‚îÄ‚îÄ migrations/                           # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (golang-migrate)
‚îú‚îÄ‚îÄ schemas/api/schema.yaml               # OpenAPI 3.1.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ config.toml                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ docker-compose.yml                    # Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ (PostgreSQL, Prometheus, Grafana)
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `config.toml`:
- `[logs]` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `[server]` - –ø–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)
- `[database]` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (–ø–æ—Ä—Ç 5435)

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤ Docker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `DATABASE_HOST=postgres` (–∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –≤ Docker network)
- `DATABASE_PORT=5432` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- `DATABASE_USER`, `DATABASE_PASSWORD`, `DATABASE_NAME`

–ü—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `config.toml` (host=localhost, port=5435).

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å

### –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (MVP)

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º endpoints —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–≤–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞:
```
X-User-ID: <telegram_user_id>
X-User-Role: <client|manager|superuser>
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è MVP. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π Auth Service.

### –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3 —Ä–æ–ª–∏:

#### 1. **Client** (–∫–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–æ–π–∫–∏)
- –ú–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ**
- –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏**
- –ù–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 2. **Manager** (–º–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ–º–æ–π–∫–∏)
- –ò–º–µ–µ—Ç —Ç–µ –∂–µ –ø—Ä–∞–≤–∞, —á—Ç–æ –∏ Client –¥–ª—è —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ (–≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö)
- –ù–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

#### 3. **Superuser** (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã)
- **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º
- –ú–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –ª—é–±—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ª—é–±—ã–º–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏
- –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–µ–∫

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ä–æ–ª—è–º–∏

**–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ:**
```bash
curl -X GET http://localhost:8080/users/me \
  -H "X-User-ID: 123456789" \
  -H "X-User-Role: client"
```

**–ö–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å:**
```bash
curl -X PATCH http://localhost:8080/users/me/cars/5 \
  -H "X-User-ID: 123456789" \
  -H "X-User-Role: client" \
  -H "Content-Type: application/json" \
  -d '{"color": "–ß—ë—Ä–Ω—ã–π"}'
```

**Superuser –∏–∑–º–µ–Ω—è–µ—Ç —á—É–∂–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å (–¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω):**
```bash
curl -X PATCH http://localhost:8080/users/me/cars/5 \
  -H "X-User-ID: 999999999" \
  -H "X-User-Role: superuser" \
  -H "Content-Type: application/json" \
  -d '{"color": "–ö—Ä–∞—Å–Ω—ã–π"}'
```

**–ö–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å —á—É–∂–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å (403 Forbidden - –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω):**
```bash
curl -X PATCH http://localhost:8080/users/me/cars/5 \
  -H "X-User-ID: 123456789" \
  -H "X-User-Role: client" \
  -H "Content-Type: application/json" \
  -d '{"color": "–°–∏–Ω–∏–π"}'
# –û—Ç–≤–µ—Ç: {"code":403,"message":"Access denied to this car"}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Prometheus –º–µ—Ç—Ä–∏–∫–∏
- `http_requests_total` - —Å—á—ë—Ç—á–∏–∫ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_requests_in_flight` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

–î–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ http://localhost:8080/metrics

### Grafana Dashboard
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
- HTTP Request Rate (req/m)
- Requests In Flight
- Request Duration (p95, p99)
- Status Codes Distribution
- Requests by Endpoint

–î–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:3001 (admin/admin)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –ª–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å. –õ–æ–≥–∏ —É—Ä–æ–≤–Ω—è WARN –∏ ERROR –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/app.log`.

–£—Ä–æ–≤–Ω–∏:
- **INFO** - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **WARN** - –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (4xx)
- **ERROR** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (5xx)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ [CLAUDE.md](CLAUDE.md).

API Contract –æ–ø–∏—Å–∞–Ω –≤ [schemas/api/schema.yaml](schemas/api/schema.yaml) (OpenAPI 3.1.0).
